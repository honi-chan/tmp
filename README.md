# チャット履歴とログ表示の仕様（README）

このドキュメントは、**ChatGPT風のチャットサービス**を作るときの設計方針をまとめたものです。  
特に「チャット履歴」と「ログ表示」という2つの機能を分けて考えることが大切です。  

---

## 🎯 基本コンセプト

- **チャット履歴**  
  👉 一般ユーザー用。自分が過去に行った会話をすぐ見つけて、また続きができる。  

- **ログ表示**  
  👉 管理者用。サービス全体の会話をまとめて見たり、統計を取ったり、必要に応じて監査できる。  

⚠️ **この2つはまったく別物です。**  
用途・見える範囲・使う人が違います。  

---

## 👥 ユースケース

### 一般ユーザー
- 自分の過去の会話を一覧で見る  
- 検索して会話を探す  
- ピン留めや名前の変更で整理  
- クリックしてそのまま再開  

### 管理者
- 全ユーザー分の会話ログを一覧でチェック  
- 日付・モデル・エラー有無でフィルタ  
- 統計を確認（例：返答スピード、成功率、トークン数など）  
- 必要に応じて特定の会話を開いて中身を確認  

---

## 📋 画面イメージ（ChatGPTを参考）

### チャット履歴（ユーザー用）
- 左サイドバーに「過去の会話タイトル」が並ぶ  
- 最近使った順に並び替え  
- クリックすると会話がそのまま再開できる  

### ログ表示（管理者用）
- 真ん中に一覧表（日時・ユーザーID・モデル・コンセプトなど）  
- **一覧は軽く（コンセプトのみ）**  
- 行をクリックすると右側に詳細パネルが出て、インスピレーションや指標など全て見られる  
- 必要に応じてCSVエクスポート  

---

## 📝 必須入力項目について（お客様フィードバック）

- ユーザーが入力した内容に**必要な情報が全部入っていれば、追加入力なし**  
- 情報が不足している場合のみ、**追加項目が自動で表示される**  
  （例：「注文番号がないので入力してください」）  

---

## ✅ 設計の判断（重要ポイント）

1. **チャット履歴とログ表示は完全に分ける**  
   → 権限も画面も役割も別々  

2. **ログ表示の一覧は「軽量表示」にする**  
   → コンセプト（短い要約）のみ表示、クリックすると詳細が出る  
   → ChatGPTの管理UIと同じイメージ  

3. **必須項目は動的に追加**  
   → 入力不足なら必要な項目が画面に増える  

---

## 📊 管理者が見られるデータ例

- 会話の日付・時間  
- 利用モデル（GPT-4など）  
- トークン使用数  
- 応答にかかった時間  
- エラーの有無  
- コンセプト（会話の要約）  

詳細画面ではさらに：  
- インスピレーション（きっかけや文脈）  
- KPIや統計情報  

---

## 🔒 セキュリティ & プライバシー

- 一般ユーザーは**自分の会話だけ**見られる  
- 管理者は全体を見られるが、**個人情報は基本マスク**される  
- 本当に必要な場合のみ復号でき、必ず「理由」を記録する  

---

## 🚀 今後のタスク

- コンセプト／インスピレーションの自動要約ルールを決める  
- どの個人情報をマスクするか確定する  
- CSV出力時のフォーマットを決める  

---

## まとめ

- 「チャット履歴」はユーザー用、「ログ表示」は管理者用。完全に別物。  
- 一覧画面は軽く（要約だけ）、クリックで詳細を出すスタイル。  
- 必須項目は不足したときだけ増える。  
- プライバシー保護と監査ログを大事にする。  
